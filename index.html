<html>
<head>
<script src="three.min.js"></script>
</head>
<body>
<script type="text/javascript">

    var scene, camera, renderer;
	
    var geometryLowerSidewalk, materialSidewalk, meshLowerSidewalk;
	var geometryUpperSidewalk, meshUpperSidewalk;
	var geometryRoad, materialRoad, meshRoad;
	var geometryRiver, materialRiver, meshRiver;
	var geometryGrass, materialGrass, meshGrass;
	var geometryFrog, materialFrog, meshFrog;
	var geometryCar, materialCar, meshCar;
	var geometryBus, materialBus, meshBus;
	var geometryTurtle, materialTurtle, meshTurtle;
	var geometryTimberlog, materialTimberlog, meshTimberlog;
	
	var newfrog;
	
	var cars1 = [];
	var cars2 = [];
	var buses = [];
	var turtles1 = [];
	var turtles2 = [];
	var logs1 = [];
	var logs2 = [];
	
	var width = 800, height = 600;
	var lookat = new THREE.Vector3(0,0,0);
	
	function random(min, max){
		return Math.floor((Math.random() * max) + min);
	}
	
	var totalLifes = 5;
	var totalPoints = 0;
	
	function takeLifes(){
		frog.reset();
		totalLifes = totalLifes - 1;
		document.getElementById("lifes").innerHTML=totalLifes;
	}
	
	function addPoints(){
		totalPoints += 10;
		document.getElementById("points").innerHTML=totalPoints;
	}
	
	function BB(){
		this.vecMin = [0,0,0];
		this.vecMax = [0,0,0];
	}
	
	BB.prototype.collide = function(b){
	//Check if Box1's max is greater than Box2's min and Box1's min is less than Box2's max (if they collide)
    return(this.vecMax[0] > b.vecMin[0] && 
    this.vecMin[0] < b.vecMax[0] &&
    this.vecMax[1] > b.vecMin[1] &&
    this.vecMin[1] < b.vecMax[1] &&
    this.vecMax[2] > b.vecMin[2] &&
    this.vecMin[2] < b.vecMax[2]);
	//If not, it will return false
	};

	function Frog(startX, startY, startZ, mesh) {
		mesh.position.x = startX;
		mesh.position.y = startY;
		mesh.position.z = startZ;
		this.bb = new BB();
        this.mesh = mesh;
    }
	
	Frog.prototype.update = function () {

		if(frogMovement == "UP"){
			this.mesh.position.y += 1;
		} else if(frogMovement == "DOWN"){
			this.mesh.position.y -= 1;
		} else if(frogMovement == "LEFT"){
			this.mesh.position.x -= 1;
		} else if(frogMovement == "RIGHT"){
			this.mesh.position.x += 1;
		}
		
		this.bb.vecMin = [this.mesh.position.x-3, this.mesh.position.y-3, this.mesh.position.z-1];
		this.bb.vecMax = [this.mesh.position.x+3, this.mesh.position.y+3, this.mesh.position.z+1];
    };
	
	
    init();
    animate();

	var projection = "";
	var frogMovement = "";
	

    function handleKeyDown(event) {
		
        if (String.fromCharCode(event.keyCode) == "1") {
			projection = "PERSPECTIVE";
        }
		if (String.fromCharCode(event.keyCode) == "2") {
			projection = "ORTHO";
        }
		//q
		if (event.keyCode == 81) {
			frogMovement = "UP";
        }
		//a
		if (event.keyCode == 65) {
			frogMovement = "DOWN";
        }
		//o
		if (event.keyCode == 79) {
			frogMovement = "LEFT";
        }
		//p
		if (event.keyCode == 80) {
			frogMovement = "RIGHT";
        }
    }


    function handleKeyUp(event) {
		frogMovement = "";
    }

	var numCars = 4;
	var numBuses = 4;
	var numTurtles = 4;
	var numLogs = 4;
	
    function init() {
		
		document.onkeydown = handleKeyDown;
        document.onkeyup = handleKeyUp;
		
        scene = new THREE.Scene();

		if(projection == "PERSPECTIVE"){
        camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 100.0 );
        camera.position.z = 45;
		camera.position.y = -45;
		camera.lookAt(lookat);
		} 
		
		// material river
		materialRiver = new THREE.MeshLambertMaterial({
        map: THREE.ImageUtils.loadTexture('http://web.ist.utl.pt/~ist169471/avt2/river.jpg')
		});
		
		// material road
		materialRoad = new THREE.MeshLambertMaterial({
        map: THREE.ImageUtils.loadTexture('http://web.ist.utl.pt/~ist169471/avt2/road.jpg')
		});
	  
	  	// material road
		materialGrass = new THREE.MeshLambertMaterial({
        map: THREE.ImageUtils.loadTexture('http://web.ist.utl.pt/~ist169471/avt2/grass.jpg')
		});
		
		// material road
		materialSidewalk = new THREE.MeshLambertMaterial({
        map: THREE.ImageUtils.loadTexture('http://web.ist.utl.pt/~ist169471/avt2/sidewalk.jpg')
		});
	  
	    //lower sidewalk
        geometryLowerSidewalk = new THREE.BoxGeometry( 60, 6, 1 );
        meshLowerSidewalk = new THREE.Mesh( geometryLowerSidewalk, materialSidewalk );
		meshLowerSidewalk.position.set(0,-27,0);
        scene.add( meshLowerSidewalk );
		
		//upper sidewalk
        geometryUpperSidewalk = new THREE.BoxGeometry( 60, 6, 1 );
        meshUpperSidewalk = new THREE.Mesh( geometryUpperSidewalk, materialSidewalk );
		meshUpperSidewalk.position.set(0,-2,0);
        scene.add( meshUpperSidewalk );
		
		//river
        geometryRiver = new THREE.BoxGeometry( 60, 24, 1 );
        meshRiver = new THREE.Mesh( geometryRiver, materialRiver );
		meshRiver.position.set(0,12,0);
        scene.add( meshRiver );

		//river
        geometryRoad = new THREE.BoxGeometry( 60, 20, 1 );
        meshRoad = new THREE.Mesh( geometryRoad, materialRoad );
		meshRoad.position.set(0,-15,0);
        scene.add( meshRoad );
		
		//grass
        geometryGrass = new THREE.BoxGeometry( 60, 6, 1 );
        meshGrass = new THREE.Mesh( geometryGrass, materialGrass );
		meshGrass.position.set(0,27,0);
        scene.add( meshGrass );
		
		//frog
		geometryFrog = new THREE.SphereGeometry( 5, 32, 32 );
		materialFrog = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		meshFrog = new THREE.Mesh( geometryFrog, materialFrog );
		scene.add( meshFrog );
		newfrog = new Frog(0,-25,0, meshFrog);
		
		//car
		geometryCar = new THREE.BoxGeometry( 60, 6, 1 );
		materialCar = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		meshCar = new THREE.Mesh( geometryCar, materialCar );
		scene.add( meshCar );
		//newfrog = new Frog(0,-25,0, meshCar);
		
		//bus
		geometryBus = new THREE.BoxGeometry( 60, 6, 1 );
		materialBus = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		meshBus = new THREE.Mesh( geometryBus, materialBus );
		scene.add( meshBus );
		//newfrog = new Frog(0,-25,0, meshCar);
		
		//turtle
		geometryTurtle = new THREE.BoxGeometry( 60, 6, 1 );
		materialTurtle = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		meshTurtle = new THREE.Mesh( geometryTurtle, materialTurtle );
		scene.add( meshTurtle );
		//newfrog = new Frog(0,-25,0, meshCar);
		
		//logs
		geometryTimberlog = new THREE.BoxGeometry( 60, 6, 1 );
		materialTimberlog = new THREE.MeshBasicMaterial( {color: 0xffff00} );
		meshTimberlog = new THREE.Mesh( geometryTimberlog, materialTimberlog );
		scene.add( meshTimberlog );
		//newfrog = new Frog(0,-25,0, meshCar);
		
		for (var i=0; i < numCars; i++) {
			rnd = random(25,55);	
            cars1.push(new Car(-rnd,-9,0));
        }
		for (var i=0; i < numCars; i++) {
			rnd = random(25,5);	
            cars2.push(new Car(-rnd,-21,0));
        }
		
		for (var i=0; i < numBuses; i++) {
			rnd = random(25,5);	
            buses.push(new Bus(rnd,-16,0));
        }
		
		for (var i=0; i < numTurtles; i++) {
			rnd = random(25,5);	
            turtles1.push(new Turtle(rnd,3,0));
        }
		
		for (var i=0; i < numTurtles; i++) {
			rnd = random(25,5);	
            turtles2.push(new Turtle(rnd,15,0));
        }
		
		for (var i=0; i < numLogs; i++) {
			rnd = random(25,5);	
            logs1.push(new Timberlog(rnd,9,0));
        }
		
		for (var i=0; i < numLogs; i++) {
			rnd = random(25,5);	
            logs2.push(new Timberlog(rnd,21,0));
        }
		
		// add subtle ambient lighting
		var ambientLight = new THREE.AmbientLight(0xbbbbbb);
		scene.add(ambientLight);
	  
        renderer = new THREE.WebGLRenderer();
        renderer.setSize( width, height );

        document.body.appendChild( renderer.domElement );

    }

    function animate() {

        requestAnimationFrame( animate );

		if(projection == "PERSPECTIVE"){
			camera = new THREE.PerspectiveCamera( 45, width / height, 0.1, 100.0 );
			camera.position.z = 40;
			camera.position.y = -55;
			camera.lookAt(lookat);
		} else if(projection == "ORTHO"){
			camera = new THREE.OrthographicCamera( -30, 30, 30, -30, -5, 60);
		}
		
		newfrog.update();

        renderer.render( scene, camera );

    }

</script>
    <p>Points: <div id="points">0</div></p>
	<p>Lifes: <div id="lifes">5</div></p>
	<div id="gameover"></div>
</body>
</html>